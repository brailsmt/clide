#!/usr/local/bin/bash
# vim: fdm=marker

if [[ -z "$CLIDE_INSTALL_BASE" ]]; then
    echo "You must set CLIDE_INSTALL_BASE before using clide!"
    exit 1
fi

source $CLIDE_INSTALL_BASE/lib/common.sh

# Top level command to manage a maven java project from the command line.

if [[ -f $CLIDE_GLOBAL_CONF ]]; then
  . $CLIDE_GLOBAL_CONF
fi
if [[ -f $CLIDE_CONF ]]; then
  . $CLIDE_CONF
fi
if [[ -f $CLIDE_PRJ_CONF ]]; then
  . $CLIDE_PRJ_CONF
fi

if [[ -z $CLIDE_BIN ]]; then
    export CLIDE_BIN=$CLIDE_INSTALL_BASE/bin:$PATH
fi

clide_cmd=$1
cmd_path=''
shift
for dir in ${CLIDE_BIN//:/ }; do
  _cmd_path=$(find ${dir/#\~/$HOME} -type f -name clide-$clide_cmd 2> /dev/null)
  if [[ -x $_cmd_path ]]; then
    cmd_path=$_cmd_path
    break
  fi
done

if [[ -z $cmd_path ]]; then
  echo "Could not find $clide_cmd!  Check \$CLIDE_INSTALL_BASE and \$CLIDE_BIN and retry"
  exit 1
fi

$cmd_path "$@"
