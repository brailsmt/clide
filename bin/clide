#!/bin/bash
# vim: fdm=marker

# Top level command to manage a maven java project from the command line.

# include some basic clide environment variables for clide scripts to use
export CLIDE_GLOBAL_CONF=${CLIDE_GLOBAL_CONF:-/etc/cliderc}
export CLIDE_CONF=${CLIDE_CONF:-$HOME/.cliderc}
export CLIDE_PRJ_CONF=${CLIDE_PRJ_CONF:-.clide/cliderc}

if [[ -f $CLIDE_GLOBAL_CONF ]]; then
  . $CLIDE_GLOBAL_CONF
fi
if [[ -f $CLIDE_CONF ]]; then
  . $CLIDE_CONF
fi
if [[ -f $CLIDE_PRJ_CONF ]]; then
  . $CLIDE_PRJ_CONF
fi

CLIDE_BIN=$CLIDE_BIN:$PATH

clide_cmd=$1
cmd_path=''
shift
for dir in ${CLIDE_BIN//:/ }; do
  echo find ${dir/#\~/$HOME} -type f -name clide-$clide_cmd 
  _cmd_path=$(find ${dir/#\~/$HOME} -type f -name clide-$clide_cmd 2> /dev/null)
  if [[ -x $_cmd_path ]]; then
    cmd_path=$_cmd_path
    break
  fi
done

if [[ -z $cmd_path ]]; then
  echo "Could not find $clide_cmd!  Check \$CLIDE_BIN and retry"
  exit 1
fi

$cmd_path "$@"
