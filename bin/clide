#!/usr/bin/env ruby
# vim: fdm=marker

require 'optparse'
require 'pp'

require_relative '../lib/pom'

# Top level command to manage a java project from the command line.
## This config stuff is great, but I need functionality before configuration.
## BEGIN CONFIG
#
#require_relative '../lib/clide_opts'
#require_relative '../lib/cliderc'
#
#OPTS = get_clide_options
#conf = nil
#begin
#  conf = ClideConfig.new OPTS, ClideConfig::find_project_root
#rescue Exception => e
#  $stderr.puts e.backtrace
#  exit unless ARGV[0] == 'init'
#end
#
###
## This is the first command that needs to run, so it cannot rely on configuration.
#def do_init
#  conf = ClideConfig.new OPTS, Dir.pwd
#  conf.save
#end
## END CONFIG

def grab_imports(pom, args = nil)
  pp pom.get_dependencies
end

def main
  command = ARGV.shift

  case command
  when 'jimp'
    grab_imports POM.find_parent_pom
  else
    puts "Not implemented yet!"
  end
end

def build_classpath(deps, project)
  classpath = []
  deps['program-runtime-pipeline'].each { |dep|
    classpath << dep.get_path_to_dep
  }
  classpath.join ':'
end

#main 
pom = POM.new 'pom.xml'

pom.build_effective_pom
epom = POM.new pom.epom_fname
deps = epom.get_dependencies
puts build_classpath deps, 'program-runtime-pipeline'

