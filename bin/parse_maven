#!/usr/bin/env ruby

require 'pp'

# parse maven output for some meaningful information
# This is a pretty quick and dirty stateful parser

maven_output = ARGV[0]
build_order_file = ARGV[1]

state = :ignore

build_order = []
File.open(maven_output) { |file|
  file.each_line { |line|
    line.strip!
    if state == :ignore && line == "[INFO] Reactor Build Order:"
      state = :skip_blank
      next
    elsif state == :skip_blank && line == "[INFO]"
      next
    elsif state == :capture || (state == :skip_blank && line.start_with?("[INFO] "))
      module_name = line.split(/\s+/)[1]
      if module_name == nil
        break
      end
      build_order << module_name
      state = :capture
    end
  }
}

output = build_order_file == nil ? $stdout: File.open(build_order_file, "w") 

build_order.each { |m| output.puts m }
